/*! premise-time-track 2016-02-15 */
!function(a){a(document).ready(function(){b.init()});var b={months:["01","02","03","04","05","06","07","08","09","10","11","12"],fields:null,timestampStart:null,start:null,date:null,timestampStop:null,stop:null,timer:null,publish:null,startBtn:null,stopBtn:null,init:function(){this.startBtn=a(".ptt-start-btn")?a(".ptt-start-btn"):null,this.stopBtn=a(".ptt-stop-btn")?a(".ptt-stop-btn"):null,this.resetTimer(),this.bindEvents()},bindEvents:function(){this.startBtn.click(this.startTimer),this.stopBtn.click(this.stopTimer),this.timeField.keyup(this.inputTime),a(".ptt-new-timer").click(this.newTimer),a(".ptt-delete-time-history").click(function(){console.log("hi"),a(this).parent().slideToggle()})},startTimer:function(){var a=b.resetTimer();if(a.timestampStart.val()||""!==a.timestampStart.val()){var c=confirm("Are you sure you want to override the current time stamp?");if(!c)return!1}var d=new Date,e=a.months[d.getMonth()],f=d.getDate(),g=d.getFullYear(),h=d.getHours(),i="0"+d.getMinutes(),j=("0"+d.getSeconds(),h+":"+i.substr(-2)),k=e+"/"+f+"/"+g;return a.timestampStart.val(d),a.start.val(j),a.date.val(k),a.stop.val(""),a.timestampStop.val(""),a.saveTimer(),!1},stopTimer:function(){var a=b.resetTimer();if(""==a.start.val())return alert("You must start the timer first or fill in the 'From' field."),!1;{var c=new Date,d=c.getHours(),e="0"+c.getMinutes(),f=("0"+c.getSeconds(),d+":"+e.substr(-2)),g=a.start.val().split(":");+d-+g[0],+e-+g[1]}return a.timestampStop.val(c),a.stop.val(f),a.recordTime(),a.saveTimer(),!1},recordTime:function(a,c){var d=b;if(c=c||"00:00",""===c)return d.timer.val(""),!1;if(c=c.split(":"),c[0]="00"==c[0]?24:c[0],a=a||"00:00",""===a)return d.timer.val(""),!1;if(a=a.split(":"),c[0]>=a[0]){var e=60*(c[0]-a[0]),f=c[1]-a[1],g=+e+ +f;if(0>g)return"";var h=(Math.ceil(+g/60*4)/4).toFixed(2);return h}return""},validateTime:function(c,d){c=c||"";var e=a(d).is(".ptt-start")?"start":"stop",f=c,g=f.length,h=new RegExp(/[^0-9:]/g);if(f=f.replace(h,""),2==g&&2==f.length)return 24>+f?(a(d).val(f+":"),a(d).focusout(b.checkTimeString)):(a(d).val("00:"),a(d).focusout(b.checkTimeString)),!1;if(5==g&&5==f.length){var i=f.substr(-2);if(a(d).val(60>+i?f:f.substr(0,3)+"00"),"stop"==e){var j=a(d).parents(".ptt-fields-wrapper").find(".ptt-start").val();if(""!==j){var k=a(d).parents(".ptt-fields-wrapper").find(".ptt-timer-field");k.val(self.recordTime(j,f))}}if("start"==e){var l=a(d).parents(".ptt-fields-wrapper").find(".ptt-stop").val();if(""!==l){var k=a(d).parents(".ptt-fields-wrapper").find(".ptt-timer-field");k.val(self.recordTime(f,l))}}return!1}return g>5?(a(d).val(f.substr(0,5)),!1):void a(d).val(f)},inputTime:function(){var c=b,d=a(this).val();c.validateTime(d,this)},checkTimeString:function(c){if(str=c||"00:00",5>=str.length)if(3==str.length)a(this).val(str+"00");else if(4==str.length){{var d=str.substr(0,3);"0"+str.substr(-2)}a(this).val(d+mins),console.log(a(this).val())}else{var e=a(this).parents(".ptt-fields-wrapper").find(".ptt-start").val();if(""!==e){var f=a(this).parents(".ptt-fields-wrapper").find(".ptt-timer-field");f.val(b.recordTime(e,str))}}return!1},newTimer:function(){var c=b.resetTimer(this),d=c.countUp();a(".ptt-time-history").append('<div class="ptt-fields-wrapper ptt-time-history-'+d+'"></div>');var e=c.fields.clone();a(".ptt-time-history-"+d).append(e);var f={action:"ptt_new_timer",count:c.historyCount};return a.post(ajaxurl,f,function(b){a(".ptt-timer-fields").html(b)}).done(function(){c.resetTimer(this),c.timeField.keyup(c.validateTime)}),console.log(c.timeField),!1},saveTimer:function(){a("#publish").click()},resetTimer:function(){return self=b,self.historyCount=a(".ptt-time-history > div").length,self.fields=a(".ptt-timer").find(".ptt-timer-fields > .premise-field"),self.timestampStart=a(".ptt-timer").find("#ptt_meta-timers-"+self.historyCount+"-timestamp_start"),self.start=a(".ptt-timer").find("#ptt_meta-timers-"+self.historyCount+"-start"),self.date=a(".ptt-timer").find("#ptt_meta-timers-"+self.historyCount+"-date"),self.timestampStop=a(".ptt-timer").find("#ptt_meta-timers-"+self.historyCount+"-timestamp_stop"),self.stop=a(".ptt-timer").find("#ptt_meta-timers-"+self.historyCount+"-stop"),self.timer=a(".ptt-timer").find("#ptt_meta-timers-"+self.historyCount+"-timer"),self.timeField=a(".ptt-time-field"),self},countUp:function(){return self.historyCount+1}}}(jQuery);