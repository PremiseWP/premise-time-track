/*! premise-time-track 2016-02-23 */
!function(a){a(document).ready(function(){b.init()});var b={months:["01","02","03","04","05","06","07","08","09","10","11","12"],fields:null,timestampStart:null,start:null,date:null,timestampStop:null,stop:null,timer:null,publish:null,startBtn:null,stopBtn:null,init:function(){this.startBtn=a(".ptt-start-btn")?a(".ptt-start-btn"):null,this.stopBtn=a(".ptt-stop-btn")?a(".ptt-stop-btn"):null,this.resetTimer(),this.bindEvents(),console.log("Premise Time Track initiated successfully")},bindEvents:function(){this.startBtn.click(this.startTimer),this.stopBtn.click(this.stopTimer),this.timeField.keyup(this.inputTime),this.timeField.focusout(this.checkTimeString),a(".ptt-new-timer").click(this.newTimer),a(".ptt-delete-time-history").click(function(){a(this).parent().slideToggle()})},startTimer:function(){var a=b.resetTimer();if(a.timestampStart.val()||""!==a.timestampStart.val()){var c=confirm("Are you sure you want to override the current time stamp?");if(!c)return!1}var d=new Date,e=a.months[d.getMonth()],f=d.getDate(),g=d.getFullYear(),h=d.getHours(),i="0"+d.getMinutes(),j=("0"+d.getSeconds(),h+":"+i.substr(-2)),k=e+"/"+f+"/"+g;return a.timestampStart.val(d),a.start.val(j),a.date.val(k),a.stop.val(""),a.timestampStop.val(""),a.saveTimer(),!1},stopTimer:function(){var a=b.resetTimer();if(""==a.start.val())return alert("You must start the timer first or fill in the 'From' field."),!1;var c=new Date,d=c.getHours(),e="0"+c.getMinutes(),f=("0"+c.getSeconds(),d+":"+e.substr(-2)),g=a.start.val();return a.timestampStop.val(c),a.stop.val(f),a.timer.val(a.recordTime(g,f)),a.saveTimer(),!1},recordTime:function(a,c){var d=b;if(c=c||"00:00",""===c)return d.timer.val(""),!1;if(c=c.split(":"),c[0]="00"==c[0]?24:c[0],a=a||"00:00",""===a)return d.timer.val(""),!1;if(a=a.split(":"),c[0]>=a[0]){var e=60*(c[0]-a[0]),f=c[1]-a[1],g=+e+ +f;if(0>g)return"";var h=(Math.ceil(+g/60*4)/4).toFixed(2);return h}return""},validateTime:function(b){b=b||"";var c=b,d=c.length;console.log(c);var e=new RegExp(/[^0-9:]/g);if(c=c.replace(e,""),2==d&&2==c.length)return 24>+c?c+":":"00:";if(5==d&&5==c.length){var f=c.substr(-2);return 60>+f?c:c.substr(0,3)+"00"}return d>5?(a(el).val(c.substr(0,5)),!1):c},inputTime:function(){var c=b,d=a(this).val(),e=a(this).is(".ptt-start")?!1:!0;if(a(this).val(b.validateTime(d)),e){var f=a(this).parents(".ptt-fields-wrapper").find(".ptt-start").val();if(""!==f){var g=a(this).parents(".ptt-fields-wrapper").find(".ptt-timer-field");g.val(c.recordTime(f,d))}}else{var h=a(this).parents(".ptt-fields-wrapper").find(".ptt-stop").val();if(""!==h){var g=a(this).parents(".ptt-fields-wrapper").find(".ptt-timer-field");g.val(c.recordTime(d,h))}}},checkTimeString:function(){if(str=a(this).val(),5>=str.length)if(3==str.length)a(this).val(str+"00");else if(4==str.length){{var c=str.substr(0,3);"0"+str.substr(-2)}a(this).val(c+mins),console.log(a(this).val())}else{var d=a(this).parents(".ptt-fields-wrapper").find(".ptt-start").val();if(""!==d){var e=a(this).parents(".ptt-fields-wrapper").find(".ptt-timer-field");e.val(b.recordTime(d,str))}}return!1},newTimer:function(){var c=b.resetTimer(this),d=c.countUp();a(".ptt-time-history").append('<div class="ptt-fields-wrapper ptt-time-history-'+d+'"></div>');var e=c.fields.clone();a(".ptt-time-history-"+d).append(e);var f={action:"ptt_new_timer",count:c.historyCount};return a.post(ajaxurl,f,function(b){a(".ptt-timer-fields").html(b)}).done(function(){c.resetTimer(this),c.timeField.keyup(c.inputTime)}),console.log(c.timeField),!1},saveTimer:function(){a("#publish").click()},resetTimer:function(){return self=b,self.historyCount=a(".ptt-time-history > div").length,self.fields=a(".ptt-timer").find(".ptt-timer-fields > .premise-field"),self.timestampStart=a(".ptt-timer").find("#ptt_meta-timers-"+self.historyCount+"-timestamp_start"),self.start=a(".ptt-timer").find("#ptt_meta-timers-"+self.historyCount+"-start"),self.date=a(".ptt-timer").find("#ptt_meta-timers-"+self.historyCount+"-date"),self.timestampStop=a(".ptt-timer").find("#ptt_meta-timers-"+self.historyCount+"-timestamp_stop"),self.stop=a(".ptt-timer").find("#ptt_meta-timers-"+self.historyCount+"-stop"),self.timer=a(".ptt-timer").find("#ptt_meta-timers-"+self.historyCount+"-timer"),self.timeField=a(".ptt-time-field"),self},countUp:function(){return self.historyCount+1}}}(jQuery);